<!-- @autogenerated -->
<mat-form-field>
  <mat-label>{{ label() + '.label' }}</mat-label>
  <input
    matInput
    [value]="value()"
    [required]="required()"
    [readonly]="true"
    placeholder="{{ label() + '.placeholder' | transloco }}"
  />
  <div matSuffix style="display: flex; padding: 5px">
    <mat-icon (click)="downloadFile()" style="cursor: pointer">download</mat-icon>
    <mat-icon (click)="selectFile()" style="cursor: pointer">cloud_upload</mat-icon>
  </div>

  @for (error of errorMessages(); track $index) {
    <mat-error>
      {{ label() + '.error.' + error | transloco }}
    </mat-error>
  }
</mat-form-field>

<ng-template #fileDialog>
  <div class="dialog-header">
    <h2 mat-dialog-title>{{ 'component.fileupload.selectFile' | transloco }}</h2>
    <button mat-icon-button (click)="dialogRef?.close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <mat-dialog-content>
    @if (uploadState() === 'select') {
      <div class="upload-view">
        <div
          class="dropzone"
          [class.dragover]="isDragOver"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
        >
          <div class="dropzone-content">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <p>{{ 'component.fileupload.dragAndDrop' | transloco }}</p>
            <p class="or-divider">{{ 'component.fileupload.or' | transloco }}</p>
            <button mat-flat-button color="primary" (click)="openFileBrowser($event, openButton)">
              {{ 'component.fileupload.chooseFile' | transloco }}
            </button>
            <input #openButton style="display: none" (change)="showPreviewImage($event)" type="file" />
          </div>
        </div>
      </div>
    }
    <!-- Upload Progress View -->
    @if (uploadState() === 'uploading') {
      <div class="upload-view">
        <div class="progress-container">
          <h3>{{ 'component.fileupload.uploading' | transloco }}</h3>
          <p>{{ selectedFileName }}</p>
          <mat-progress-bar [value]="progressValue()" color="primary"></mat-progress-bar>
          <span class="progress-value">{{ progressValue() }}%</span>
          <button mat-flat-button color="warn" class="cancel-button" (click)="cancelUpload()">
            {{ 'component.fileupload.cancel' | transloco }}
          </button>
        </div>
      </div>
    }

    <!-- Upload Complete View -->
    @if (uploadState() === 'complete') {
      <div class="upload-view">
        <div class="upload-complete">
          <div class="file-summary">
            <mat-icon class="success-icon">check_circle</mat-icon>
            <h3>{{ 'component.fileupload.uploadComplete' | transloco }}</h3>

            <div class="file-info">
              <mat-icon>insert_drive_file</mat-icon>
              <span class="file-name">{{ selectedFileName }}</span>
            </div>

            <!-- File Preview (if image) -->
            @if (isImageFile && filePreviewUrl) {
              <div class="file-preview">
                <img [src]="filePreviewUrl" alt="File preview" />
              </div>
            }
            <button mat-stroked-button color="primary" class="discard-button" (click)="discardAndChooseAnother()">
              {{ 'component.fileupload.discardAndChooseAnother' | transloco }}
            </button>
          </div>
        </div>
      </div>
    }
  </mat-dialog-content>

  <mat-divider></mat-divider>

  <mat-dialog-actions>
    <button mat-button color="warn" (click)="save(null)">
      {{ 'component.fileupload.quit' | transloco }}
    </button>
    <button [disabled]="!response()" mat-flat-button color="primary" (click)="save(response())">
      {{ 'component.fileupload.accept' | transloco }}
    </button>
  </mat-dialog-actions>
</ng-template>
