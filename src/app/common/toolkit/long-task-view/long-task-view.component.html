<!-- @autogenerated -->
<h2 mat-dialog-title>{{ title }}</h2>
<mat-dialog-content>
  <div style="min-width: 600px"></div>
  @if (status !== 'FINISHED' && status !== 'FAILED') {
    <h1>Working with {{ step }} {{ currentStepProgress }}</h1>
    @if (known) {
      <mat-spinner [mode]="'determinate'" value="{{ currentStepProgress }}"></mat-spinner>
    } @else {
      <mat-spinner [mode]="'indeterminate'"></mat-spinner>
    }
  }
  @if (status === 'FAILED') {
    <h1>The process failed</h1>
  }
  @if (status === 'FINISHED') {
    <mat-accordion class="headers-align" multi>
      @for (task of tasks; track $index) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title> {{ task.name }} </mat-panel-title>
            <mat-panel-description>
              Correctos: {{ task.oks.length || 0 }} / {{ task.processedItems }}
              @if (!task.errors.length && !task.warns.length) {
                <mat-icon>check_circle</mat-icon>
              }
              @if (!task.errors.length && task.warns.length) {
                <mat-icon>warning</mat-icon>
              }
              @if (task.errors.length) {
                <mat-icon>error</mat-icon>
              }
            </mat-panel-description>
          </mat-expansion-panel-header>

          @if (allTheSame(task)) {
            <ul>
              @for (ok of task.oks; track $index) {
                <li>{{ ok }}</li>
              }
              @for (warn of task.warns; track $index) {
                <li>
                  {{ warn.item }}
                  <ul>
                    @for (fail of warn.fails; track $index) {
                      <li>
                        {{ fail }}
                      </li>
                    }
                  </ul>
                </li>
              }
              @for (error of task.errors; track $index) {
                <li>
                  {{ error.item }}
                  <ul>
                    @for (fail of error.fails; track $index) {
                      <li>
                        {{ fail }}
                      </li>
                    }
                  </ul>
                </li>
              }
            </ul>
          } @else {
            <mat-accordion class="headers-align">
              @if (task.oks.length) {
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title> Correctos </mat-panel-title>
                    <mat-panel-description> {{ task.oks.length }} / {{ task.processedItems }} </mat-panel-description>
                  </mat-expansion-panel-header>
                  <ul>
                    @for (ok of task.oks; track $index) {
                      <li>{{ ok }}</li>
                    }
                  </ul>
                </mat-expansion-panel>
              }
              @if (task.warns.length) {
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title> Para revisar </mat-panel-title>
                    <mat-panel-description> {{ task.warns.length }} / {{ task.processedItems }} </mat-panel-description>
                  </mat-expansion-panel-header>
                  <ul>
                    @for (warn of task.warns; track $index) {
                      {{ warn.item }}
                      <ul>
                        @for (fail of warn.fails; track $index) {
                          <li>
                            {{ fail }}
                          </li>
                        }
                      </ul>
                    }
                  </ul>
                </mat-expansion-panel>
              }

              @if (task.errors.length) {
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title> Con errores </mat-panel-title>
                    <mat-panel-description>
                      {{ task.errors.length }} / {{ task.processedItems }}
                    </mat-panel-description>
                  </mat-expansion-panel-header>
                  <ul>
                    @for (error of task.errors; track $index) {
                      {{ error.item }}
                      <ul>
                        @for (fail of error.fails; track $index) {
                          <li>
                            {{ fail }}
                          </li>
                        }
                      </ul>
                    }
                  </ul>
                </mat-expansion-panel>
              }
            </mat-accordion>
          }
        </mat-expansion-panel>
      }
    </mat-accordion>
  }
</mat-dialog-content>
<mat-dialog-actions>
  <button mat-button mat-dialog-close cdkFocusInitial>Ok</button>
</mat-dialog-actions>
